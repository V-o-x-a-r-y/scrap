function sleep(e){return new Promise(t=>setTimeout(t,e))}async function downloadImages(e,t,a,l){let n=new JSZip,r=document.getElementById("progressBar");r.value=0;let i=0,c=100/(l-a+1),m=!1;for(let d=a;d<=l;d++){let g=`${e}${d}.jpg`,s=`image_${d}.jpg`;try{let o=await downloadImage(g);n.file(`images/${s}`,o),i+=c,r.value=Math.min(i,100),console.log(`Image ${s} t\xe9l\xe9charg\xe9e avec succ\xe8s.`)}catch(u){console.error(`Erreur lors du t\xe9l\xe9chargement de l'image ${s} :`,u),m=!0;break}await sleep(500)}m||(console.log("T\xe9l\xe9chargement termin\xe9 avec succ\xe8s."),n.generateAsync({type:"blob"}).then(e=>{saveAs(e,`images_chapitre_${t}.zip`),console.log("Archive ZIP cr\xe9\xe9e avec succ\xe8s.")}).catch(e=>console.error("Erreur lors de la cr\xe9ation de l'archive ZIP :",e)))}function downloadImage(e){return console.log(`T\xe9l\xe9chargement de l'image depuis : ${e}`),new Promise((t,a)=>{fetch(e).then(e=>{if(!e.ok)throw Error(`Erreur HTTP ${e.status}`);return e.blob()}).then(e=>t(e)).catch(e=>a(e))})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("downloadButton").addEventListener("click",function(){let e=document.getElementById("baseURL").value.trim(),t=document.getElementById("chapterNumber").value.trim(),a=document.getElementById("startNumber").value.trim(),l=document.getElementById("lastNumber").value.trim();if(!t&&e.includes("/")){let n=e.split("/"),r=n[n.length-1],i=r.match(/\d+/);i&&(t=i[0])}if((!a||!l)&&e.includes("/")){let c=e.split("/"),m=c[c.length-1],d=m.match(/(\d+)-(\d+)/);d&&(a=d[1],l=d[2])}if(!a||!l){alert("Impossible de d\xe9tecter automatiquement la plage d'images. Veuillez sp\xe9cifier manuellement la plage d'images.");return}console.log("Lancement du t\xe9l\xe9chargement des images..."),downloadImages(e,t,parseInt(a),parseInt(l))})});